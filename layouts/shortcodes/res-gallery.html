{{- $myDefaultResPagePath  :=  `resources/images` }}
{{- $myDefaultMatch        :=  `**/*`   }}
{{- $myDefaultCommand      :=  `Resize` }}
{{- $myDefaultOptions      :=  `400x`   }}
{{- $myDefaultCaptionLong  :=  `%%F`    }}
{{- $myDefaultCaptionShort :=  `%%N`    }}
{{- $myDefaultThumbSize    :=  `100x`   }}

{{- $.Scratch.Set `theResPagePath`  ( (.Get `path`             ) | default $myDefaultResPagePath  ) }}
{{- $.Scratch.Set `theMatch`        ( (.Get `match`            ) | default $myDefaultMatch        ) }}
{{- $.Scratch.Set `theCommand`      ( (.Get `cmd`              ) | default $myDefaultCommand      ) }}
{{- $.Scratch.Set `theOptions`      ( (.Get `opt`              ) | default $myDefaultOptions      ) }}
{{- $.Scratch.Set `theCaptionLong`  ( (.Get `capLng`           ) | default $myDefaultCaptionLong  ) }}
{{- $.Scratch.Set `theCaptionShort` ( (.Get `capSrt`           ) | default $myDefaultCaptionShort ) }}
{{- $.Scratch.Set `theCapPos`       ( (.Get `caption-position` ) | default `bottom`               ) }}
{{- $.Scratch.Set `theCapEff`       ( (.Get `caption-effect`   ) | default `slide`                ) }}
{{- $.Scratch.Set `theHovEff`       ( (.Get `hover-effect`     ) | default `zoom`                 ) }}
{{- $.Scratch.Set `theHovTra`       ( (.Get `hover-transition` ) | default ``                     ) }}


{{- $myResPagePath := $.Scratch.Get `theResPagePath` }}
{{- if eq $myResPagePath `.`}}
  {{- $.Scratch.Set `theResPage` .Page }}
{{- else }}
  {{- $.Scratch.Set `theResPage` (.Site.GetPage "page" $myResPagePath ) }}
{{- end }}

{{- $myResPage      := $.Scratch.Get `theResPage`  }}
{{- $myResMatch     := $.Scratch.Get `theMatch`    }}
{{- $myCommand      := $.Scratch.Get `theCommand` }}
{{- $myOptions      := $.Scratch.Get `theOptions` }}
{{- $myCaptionLong  := $.Scratch.Get `theCaptionLong` }}
{{- $myCaptionShort := $.Scratch.Get `theCaptionShort` }}

{{- $myCapPos   := printf "caption-position-%s" ($.Scratch.Get `theCapPos`)}}
{{- $myCapEff   := printf "caption-effect-%s"   ($.Scratch.Get `theCapEff`)}}
{{- $myHovEff   := printf "hover-effect-%s"     ($.Scratch.Get `theHovEff`)}}
{{- $myHovTra   := cond (ne ($.Scratch.Get `theHovTra`) `none`)  (`hover-transition`) (``) }}

{{- if true -}}
{{- end -}}
{{- if or $.Site.Params.debug (findRE `\bdebug-shortcode(s|-heg-res-gallery)\b` $.Site.Params.traceFlags) -}}
<br/>
$myResPagePath  : {{ $myResPagePath  }} <br/>
$myResMatch"    : {{ $myResPagePath  }} <br/>
$myResPage      : {{ $myResPage      }} <br/>
$myResMatch     : {{ $myResMatch     }} <br/>
$myCommand      : {{ $myCommand      }} <br/>
$myOptions      : {{ $myOptions      }} <br/>
$myCaptionLong  : {{ $myCaptionLong  }} <br/>
$myCaptionShort : {{ $myCaptionShort }} <br/>
$myCapPos       : {{ $myCapPos       }} <br/>
$myCapEff       : {{ $myCapEff       }} <br/>
$myHovEff       : {{ $myHovEff       }} <br/>
$myHovTra       : {{ $myHovTra       }} <br/>
$myResPage      : {{ $myResPage      }} <br/>
$myResPage.Dir  : {{ $myResPage.Dir  }} <br/>
{{- end -}}


{{- $mybaseURL := $.Site.BaseURL }}

<div class='res-gallery {{$myCapPos}} {{$myCapEff}} {{$myHovEff}} {{$myHovTra}}' itemscope itemtype="http://schema.org/ImageGallery">
{{- range $myResImgage := ( ($myResPage.Resources.ByType `image`).Match (printf "%s*" $myResMatch)) }}
  {{- if not (findRE `\.(svg)$` (lower $myResImgage.Name)) }}
    {{- $myCommand  := ( $myResImgage.Params.imgcmd       | default $myCommand ) }}
    {{- $myOptions  := ( $myResImgage.Params.imgopt       | default $myOptions ) }}
    {{- $myCapLong  := ( $myResImgage.Params.caption      | default $myCaptionLong ) }}
    {{- $myCapLong  := ( $myResImgage.Params.captionlong  | default $myCapLong ) }}
    {{- $myCapShort := ( $myResImgage.Params.captionshort | default $myCaptionShort ) }}

    {{- $myCapFileName     := replaceRE `.*/`      (``) ($myResImgage.Name) }}
    {{- $myCapFileBase     := replaceRE `\.[^.]+$` (``) ($myCapFileName)   }}
    {{- $myCapFileHumanize := humanize $myCapFileName }}

    {{- $myCapLong := replaceRE `%%n` (`<br/>`)             $myCapLong }}
    {{- $myCapLong := replaceRE `%%f`  ($myResImgage.Name)  $myCapLong }}
    {{- $myCapLong := replaceRE `%%F`  ($myCapFileName)     $myCapLong }}
    {{- $myCapLong := replaceRE `%%B`  ($myCapFileBase)     $myCapLong }}
    {{- $myCapLong := replaceRE `%%T`  ($myResImgage.Title) $myCapLong }}
    {{- $myCapLong := replaceRE `%%N`  (cond (eq $myResImgage.Name $myResImgage.Title) (humanize $myCapFileBase) (humanize $myResImgage.Title) ) $myCapLong }}
    {{- $myCapLong := replaceRE `%%l`  (cond (not (isset $myResImgage.Params "licenselink") ) ($myResImgage.Params.licenseabrv) (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.licenselink | default "") ($myResImgage.Params.licenseabrv | default "") ) ) $myCapLong }}
    {{- $myCapLong := replaceRE `%%L`  (cond (not (isset $myResImgage.Params "licenselink") ) ($myResImgage.Params.license)     (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.licenselink | default "") ($myResImgage.Params.license     | default "") ) ) $myCapLong }}
    {{- $myCapLong := replaceRE `%%O`  (cond (not (isset $myResImgage.Params "originlink" ) ) ($myResImgage.Params.origin)      (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.originlink  | default "") ($myResImgage.Params.origin      | default "") ) ) $myCapLong }}
    {{- $myCapLong := replaceRE `%%A`  (cond (not (isset $myResImgage.Params "attrlink"   ) ) ($myResImgage.Params.attrby)      (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.attrlink    | default "") ($myResImgage.Params.attrby      | default "") ) ) $myCapLong }}
    {{- $myCapLong := replaceRE `%%I`  (printf "%s '%s'" $myCommand $myOptions) $myCapLong }}

    {{- $myCapShort := replaceRE `%%n` (`<br/>`)             $myCapShort }}
    {{- $myCapShort := replaceRE `%%f`  ($myResImgage.Name)  $myCapShort }}
    {{- $myCapShort := replaceRE `%%F`  ($myCapFileName)     $myCapShort }}
    {{- $myCapShort := replaceRE `%%B`  ($myCapFileBase)     $myCapShort }}
    {{- $myCapShort := replaceRE `%%T`  ($myResImgage.Title) $myCapShort }}
    {{- $myCapShort := replaceRE `%%N`  (cond (eq $myResImgage.Name $myResImgage.Title) (humanize $myCapFileBase) (humanize $myResImgage.Title) ) $myCapShort }}
    {{- $myCapShort := replaceRE `%%l`  (cond (not (isset $myResImgage.Params "licenselink") ) ($myResImgage.Params.licenseabrv) (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.licenselink | default "") ($myResImgage.Params.licenseabrv | default "") ) ) $myCapShort }}
    {{- $myCapShort := replaceRE `%%L`  (cond (not (isset $myResImgage.Params "licenselink") ) ($myResImgage.Params.license)     (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.licenselink | default "") ($myResImgage.Params.license     | default "") ) ) $myCapShort }}
    {{- $myCapShort := replaceRE `%%O`  (cond (not (isset $myResImgage.Params "originlink" ) ) ($myResImgage.Params.origin)      (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.originlink  | default "") ($myResImgage.Params.origin      | default "") ) ) $myCapShort }}
    {{- $myCapShort := replaceRE `%%A`  (cond (not (isset $myResImgage.Params "attrlink"   ) ) ($myResImgage.Params.attrby)      (printf "<a href='%s' target='_blank'>%s</a>" ($myResImgage.Params.attrlink    | default "") ($myResImgage.Params.attrby      | default "") ) ) $myCapShort }}
    {{- $myCapShort := replaceRE `%%I`  (printf "%s '%s'" $myCommand $myOptions) $myCapShort }}

    {{- if or $.Site.Params.debug (findRE `\bdebug-shortcode(s|-heg-res-gallery)\b` $.Site.Params.traceFlags) }}
      <br/>
      "$myCommand"                      : {{ $myCommand                      }} <br/>
      "$myOptions"                      : {{ $myOptions                      }} <br/>
      "$myCapLong"                      : {{ $myCapLong                      }} <br/>
      "$myCapShort"                     : {{ $myCapShort                     }} <br/>
      "$myResImgage.Name"               : {{ $myResImgage.Name               }} <br/>
      "$myResImgage.Title"              : {{ $myResImgage.Title              }} <br/>
      "$myResImgage.Params.origin"      : {{ $myResImgage.Params.origin      }} <br/>
      "$myResImgage.Params.originlink"  : {{ $myResImgage.Params.originlink  }} <br/>
      "$myResImgage.Params.license"     : {{ $myResImgage.Params.license     }} <br/>
      "$myResImgage.Params.licenseAbrv" : {{ $myResImgage.Params.licenseabrv }} <br/>
      "$myResImgage.Params.licenselink" : {{ $myResImgage.Params.licenselink }} <br/>
      "$myResImgage.Params.attrby"      : {{ $myResImgage.Params.attrby      }} <br/>
      "$myResImgage.Params.attrlink"    : {{ $myResImgage.Params.attrlink    }} <br/>
      "$myResImgage.Params.imgcmd"      : {{ $myResImgage.Params.imgcmd      }} <br/>
      "$myResImgage.Params.imgopt"      : {{ $myResImgage.Params.imgopt      }} <br/>
    {{- end }}

    {{- $myRegGalleryImage := $myResImgage.Resize "300x" }}
    {{- $myRegGalleryThumb := $myResImgage.Fill   "80x80" }}
    {{- $myRegGalleryImageCaption := $myCapLong }}
    {{- $myRegGalleryThumbCaption := $myCapShort }}
  <div class='res-gallery-box' itemscope itemtype="http://schema.org/ImageGallery">
    <figure class="img"
            data-size='{{$myRegGalleryImage.Width}}x{{$myRegGalleryImage.Height}}'
            data-caption='{{$myRegGalleryImageCaption}}'
            itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"
            title="{{$myRegGalleryImageCaption | safeHTML}}"
    >
      <a itemprop="contentUrl" href='{{$myRegGalleryImage.RelPermalink}}' >
        <img itemprop="thumbnail"
             src='{{$myRegGalleryThumb.RelPermalink}}'
             alt='{{$myRegGalleryImageCaption}}'
             {{/* width='{{$myRegGalleryThumb.Width}}'  height='{{$myRegGalleryThumb.Height}}' */}}
        />
      </a>
      <meta itemprop="width"  content='{{$myRegGalleryImage.Width}}'>
      <meta itemprop="height" content='{{$myRegGalleryImage.Height}}'>
      <figcaption class="res-gallery-figcaption" itemprop="caption description">
        <small>{{$myRegGalleryThumbCaption | safeHTML}}</small>
      </figcaption>
{{/*
      <figcaption class="res-gallery-figcaption" itemprop="caption description">
        {{$myRegGalleryThumbCaption | safeHTML}}
        <span itemprop="copyrightHolder">Photo: AP</span>
      </figcaption>
*/}}
    </figure>
  </div> {{/* 'res-gallery-box */}}

  {{- end }}

{{- end }}

</div>
{{/*
http://photoswipe.com/documentation/seo.html
*/}}
